<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Input Behaviors</title>
    <link rel="stylesheet" href="design-system.css">
    <style>
        .error { color: var(--error); font-size: 13px; margin-top: 6px; font-weight: 500; }
        .success { color: var(--success); font-size: 13px; margin-top: 6px; font-weight: 500; }
        .results-box { margin-top: 10px; padding: 14px; background: var(--bg-secondary); box-shadow: inset 0 0 0 1px var(--border-default); border-radius: var(--radius-md); font-size: 14px; color: var(--text-secondary); }
        #ajax-form-container { min-height: 50px; border: 2px dashed var(--border-default); padding: 20px; margin: 12px 0; border-radius: var(--radius-md); background: var(--bg-secondary); color: var(--text-secondary); }
        iframe { border: 1px solid var(--border-default); border-radius: var(--radius-md); }
    </style>
</head>
<body class="has-monitor">
<script>(function(){var t=localStorage.getItem('lt-theme')||'dark';document.documentElement.setAttribute('data-theme',t);})();</script>
<!-- INPUT VALUE MONITOR BAR -->
<div id="inputMonitorBar">
    <span class="monitor-title">Input Monitor</span>
    <div class="monitor-divider"></div>
    <div class="monitor-field">
        <span class="monitor-label">Active:</span>
        <span class="monitor-element-id" id="monitorActiveField">—</span>
    </div>
    <div class="monitor-divider"></div>
    <div class="monitor-field">
        <span class="monitor-label">Event Value:</span>
        <span class="monitor-value" id="monitorEventValue">—</span>
    </div>
    <div class="monitor-divider"></div>
    <div class="monitor-field">
        <span class="monitor-label">.value:</span>
        <span class="monitor-value" id="monitorDomValue">—</span>
    </div>
    <div class="monitor-divider"></div>
    <div class="monitor-field">
        <span class="monitor-label">Source:</span>
        <span class="monitor-source" id="monitorSource">—</span>
    </div>
    <div class="monitor-divider"></div>
    <div class="monitor-field">
        <span class="monitor-label">Keys:</span>
        <span class="monitor-value" id="monitorKeyLog" style="max-width:200px;">—</span>
    </div>
    <div class="monitor-divider" id="monitorGroupDivider" style="display:none;"></div>
    <div class="monitor-field" id="monitorGroupSection" style="display:none;">
        <span class="monitor-group-label" id="monitorGroupLabel">—</span>
        <span class="monitor-value group-val" id="monitorGroupValue">—</span>
    </div>
</div>

<div class="top-bar"></div>
<div class="glow-container"><div class="glow-inner"></div></div>
<div class="glow-container glow-2"><div class="glow-inner"></div></div>

<header class="site-header">
    <div class="header-inner">
        <a href="index.html" class="logo">
            <div class="logo-icon">LT</div>
            <div class="logo-text">Input Behaviors</div>
        </a>
        <nav class="header-nav">
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                <span class="icon-sun">&#9728;</span>
                <span class="icon-moon">&#9790;</span>
            </button>
            <a href="index.html" class="header-btn">
                <svg viewBox="0 0 20 20" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 10H5M5 10l4-4M5 10l4 4"/></svg>
                <span class="hide-mobile">All Pages</span>
            </a>
        </nav>
    </div>
</header>

<main class="container-narrow">

    <div class="page-hero">
        <h1>Input Behaviors</h1>
        <p class="subtitle">Live Search, Debounce, Blur Validation, Modal, AJAX Forms &amp; iFrame</p>
    </div>

    <!-- Live Search (API on each keystroke) -->
    <div class="section-card">
        <div class="section-card-header">
            <h2>Live Search (API on Each Keystroke)</h2>
        </div>
        <label for="liveSearch">Live Search</label>
        <input type="text" id="liveSearch" placeholder="Type to search..." autocomplete="off">
        <span class="hint">Fires fetch() on every keystroke</span>
        <div class="results-box" id="liveSearchResults">Search results will appear here...</div>
    </div>

    <!-- Debounced Search -->
    <div class="section-card">
        <div class="section-card-header">
            <h2>Debounced Search (300ms Delay)</h2>
        </div>
        <label for="debouncedSearch">Debounced Search</label>
        <input type="text" id="debouncedSearch" placeholder="Type to search (300ms debounce)..." autocomplete="off">
        <span class="hint">Waits 300ms after last keystroke before firing API</span>
        <div class="results-box" id="debouncedResults">Results for: (waiting for input...)</div>
    </div>

    <!-- Validate on Blur -->
    <div class="section-card">
        <div class="section-card-header">
            <h2>Email Validation on Blur</h2>
        </div>
        <label for="blurEmail">Email (validate on blur)</label>
        <input type="text" id="blurEmail" placeholder="Enter email, then click away">
        <span class="hint">Validation API fires when you leave the field (blur event)</span>
        <div id="blurResult"></div>

        <label for="otherField">Other Field (click here to trigger blur)</label>
        <input type="text" id="otherField" placeholder="Click here to trigger email blur">
    </div>

    <!-- Real-time Validation -->
    <div class="section-card">
        <div class="section-card-header">
            <h2>Real-time Inline Validation</h2>
        </div>
        <label for="username">Username (min 3 chars)</label>
        <input type="text" id="username" placeholder="Choose a username" autocomplete="off">
        <div id="usernameValidation"></div>
        <span class="hint">Validates in real-time as you type</span>
    </div>

    <!-- Character Counter -->
    <div class="section-card">
        <div class="section-card-header">
            <h2>Character Counter (Tweet-style)</h2>
        </div>
        <label for="tweet">Tweet</label>
        <textarea id="tweet" rows="3" maxlength="280" placeholder="What's happening?"></textarea>
        <div class="counter" id="tweetCounter">0/280</div>
        <span class="hint">Shows character count updating in real-time</span>
    </div>

    <!-- Modal Input -->
    <div class="section-card">
        <div class="section-card-header">
            <h2>Input Inside Modal</h2>
        </div>
        <button onclick="openModal()">Open Modal</button>
        <span class="hint">Opens a modal dialog with an input field</span>
    </div>
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <h3>Modal Form</h3>
            <label for="modalInput">Modal Input</label>
            <input type="text" id="modalInput" placeholder="Type inside modal">
            <label for="modalEmail">Modal Email</label>
            <input type="email" id="modalEmail" placeholder="email@modal.com">
            <br>
            <button onclick="closeModal()">Close</button>
            <button onclick="submitModal()">Submit</button>
            <div id="modalResult"></div>
        </div>
    </div>

    <!-- AJAX Loaded Form -->
    <div class="section-card">
        <div class="section-card-header">
            <h2>AJAX Loaded Form</h2>
        </div>
        <button onclick="loadForm()">Load Form</button>
        <span class="hint">Loads a form via AJAX (simulated 1.5s delay)</span>
        <div id="ajax-form-container">Form will be loaded here...</div>
    </div>

    <!-- Iframe Input -->
    <div class="section-card">
        <div class="section-card-header">
            <h2>Input Inside Iframe</h2>
        </div>
        <iframe id="inputIframe" srcdoc='<!DOCTYPE html>
<html>
<head><style>
    body { font-family: Arial, sans-serif; padding: 15px; margin: 0; }
    input { padding: 8px; width: 280px; border: 1px solid #ccc; border-radius: 4px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
</style></head>
<body>
    <label for="iframeInput">Iframe Input</label>
    <input type="text" id="iframeInput" placeholder="Type inside iframe">
    <label for="iframePassword" style="margin-top:10px;">Iframe Password</label>
    <input type="password" id="iframePassword" placeholder="Password in iframe">
</body>
</html>' width="400" height="130"></iframe>
        <span class="hint">Input elements inside an iframe</span>
    </div>

</main>

<footer class="site-footer">
    Input Behaviors Test Page &mdash; Built for automated testing of dynamic input interactions.
</footer>

    <script>
        // --- Live Search (keystroke API) ---
        document.getElementById('liveSearch').addEventListener('input', function() {
            var query = this.value;
            if (query.length < 1) {
                document.getElementById('liveSearchResults').textContent = 'Search results will appear here...';
                return;
            }
            document.getElementById('liveSearchResults').textContent = 'Searching...';
            fetch('https://httpbin.org/get?q=' + encodeURIComponent(query), { mode: 'cors' })
                .then(function(r) { return r.json(); })
                .then(function() {
                    document.getElementById('liveSearchResults').textContent =
                        'Search results for: "' + query + '" (found ' + Math.floor(Math.random() * 100) + ' results)';
                })
                .catch(function() {
                    document.getElementById('liveSearchResults').textContent =
                        'Search results for: "' + query + '"';
                });
        });

        // --- Debounced Search ---
        var debounceTimer;
        document.getElementById('debouncedSearch').addEventListener('input', function() {
            clearTimeout(debounceTimer);
            var query = this.value;
            document.getElementById('debouncedResults').textContent = 'Typing... (waiting for 300ms pause)';
            debounceTimer = setTimeout(function() {
                fetch('https://httpbin.org/get?q=' + encodeURIComponent(query), { mode: 'cors' })
                    .then(function(r) { return r.json(); })
                    .then(function() {
                        document.getElementById('debouncedResults').textContent = 'Results for: ' + query;
                    })
                    .catch(function() {
                        document.getElementById('debouncedResults').textContent = 'Results for: ' + query;
                    });
            }, 300);
        });

        // --- Blur Validation ---
        document.getElementById('blurEmail').addEventListener('blur', function() {
            var email = this.value;
            var isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            var resultDiv = document.getElementById('blurResult');
            fetch('https://httpbin.org/get?email=' + encodeURIComponent(email), { mode: 'cors' })
                .then(function() {
                    if (isValid) {
                        resultDiv.innerHTML = '<span class="success">Email valid</span>';
                    } else {
                        resultDiv.innerHTML = '<span class="error">Invalid email format</span>';
                    }
                })
                .catch(function() {
                    if (isValid) {
                        resultDiv.innerHTML = '<span class="success">Email valid</span>';
                    } else {
                        resultDiv.innerHTML = '<span class="error">Invalid email format</span>';
                    }
                });
        });

        // --- Real-time Validation ---
        document.getElementById('username').addEventListener('input', function() {
            var val = this.value;
            var div = document.getElementById('usernameValidation');
            if (val.length === 0) {
                div.innerHTML = '';
            } else if (val.length < 3) {
                div.innerHTML = '<span class="error">Too short (min 3 characters)</span>';
            } else if (val.length > 20) {
                div.innerHTML = '<span class="error">Too long (max 20 characters)</span>';
            } else {
                div.innerHTML = '<span class="success">Valid username</span>';
            }
        });

        // --- Character Counter ---
        document.getElementById('tweet').addEventListener('input', function() {
            document.getElementById('tweetCounter').textContent = this.value.length + '/280';
        });

        // --- Modal ---
        function openModal() {
            document.getElementById('modalOverlay').classList.add('active');
            setTimeout(function() {
                document.getElementById('modalInput').focus();
            }, 100);
        }
        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }
        function submitModal() {
            var val = document.getElementById('modalInput').value;
            document.getElementById('modalResult').textContent = 'Submitted: ' + val;
        }

        // --- AJAX Form Load ---
        function loadForm() {
            var container = document.getElementById('ajax-form-container');
            container.innerHTML = '<p>Loading form...</p>';
            setTimeout(function() {
                container.innerHTML =
                    '<label for="ajaxName" style="font-weight:bold;">Name (loaded via AJAX)</label>' +
                    '<input type="text" id="ajaxName" placeholder="Enter your name" style="padding:8px; width:350px; border:1px solid #ccc; border-radius:4px;">' +
                    '<br><br>' +
                    '<label for="ajaxComment" style="font-weight:bold;">Comment</label>' +
                    '<textarea id="ajaxComment" rows="3" placeholder="Your comment..." style="padding:8px; width:350px; border:1px solid #ccc; border-radius:4px;"></textarea>' +
                    '<br><br>' +
                    '<button onclick="document.getElementById(\'ajax-form-container\').innerHTML=\'Submitted: \' + document.getElementById(\'ajaxName\').value" ' +
                    'style="padding:8px 16px; background:#FF9800; color:white; border:none; border-radius:4px; cursor:pointer;">Submit</button>';
            }, 1500);
        }
    </script>
<!-- INPUT VALUE MONITOR SCRIPT -->
<script>
(function() {
    var eventValue = '';
    var keyLog = [];
    var activeField = null;
    var inputEventFired = false;
    var activeGroup = null;
    var activeGroupLabel = '';

    function getFieldLabel(el) {
        var label = '';
        if (el.id) label = '#' + el.id;
        else if (el.name) label = '[name=' + el.name + ']';
        else if (el.placeholder) label = '"' + el.placeholder.substring(0, 20) + '..."';
        else if (el.className) label = '.' + el.className.split(' ')[0];
        else label = el.tagName.toLowerCase();
        var type = el.getAttribute('type') || el.tagName.toLowerCase();
        return label + ' (' + type + ')';
    }

    function detectGroup(el) {
        if (el.tagName !== 'INPUT') return null;
        if (el.getAttribute('maxlength') !== '1') return null;
        var parent = el.parentElement;
        if (!parent) return null;
        var elClasses = Array.from(el.classList);
        var siblings = Array.from(parent.querySelectorAll('input[maxlength="1"]'));
        if (siblings.length < 2) return null;
        if (elClasses.length === 0) return siblings;
        var group = siblings.filter(function(sib) {
            return elClasses.some(function(cls) { return sib.classList.contains(cls); });
        });
        return group.length >= 2 ? group : null;
    }

    function getGroupLabel(group) {
        if (!group || group.length === 0) return '';
        var first = group[0]; var last = group[group.length - 1];
        var type = 'Group';
        if (first.classList.contains('otp-digit')) type = 'OTP';
        else if (first.classList.contains('pin-digit')) type = 'PIN';
        var firstId = first.id ? '#' + first.id : '?';
        var lastId = last.id ? '#' + last.id : '?';
        return type + ' ' + firstId + ' \u2192 ' + lastId + ' (' + group.length + ' fields)';
    }

    function getGroupValue(group) {
        if (!group) return '';
        return group.map(function(el) { return el.value || '_'; }).join('');
    }

    function isSameGroup(a, b) {
        if (!a || !b) return false;
        if (a.length !== b.length) return false;
        return a[0] === b[0];
    }

    function updateBar() {
        var domVal = activeField ? (activeField.value || activeField.textContent || '') : '';
        document.getElementById('monitorActiveField').textContent = activeField ? getFieldLabel(activeField) : '—';
        document.getElementById('monitorEventValue').textContent = eventValue || '—';
        document.getElementById('monitorDomValue').textContent = domVal || '—';
        document.getElementById('monitorKeyLog').textContent = keyLog.length > 0 ? keyLog.slice(-20).join('') : '—';

        var domValEl = document.getElementById('monitorDomValue');
        var sourceEl = document.getElementById('monitorSource');
        var groupSection = document.getElementById('monitorGroupSection');
        var groupDivider = document.getElementById('monitorGroupDivider');

        if (activeGroup && activeGroup.length > 1) {
            document.getElementById('monitorGroupLabel').textContent = activeGroupLabel;
            document.getElementById('monitorGroupValue').textContent = getGroupValue(activeGroup);
            groupSection.style.display = '';
            groupDivider.style.display = '';
        } else {
            groupSection.style.display = 'none';
            groupDivider.style.display = 'none';
        }

        if (!activeField || (!eventValue && !domVal)) {
            sourceEl.textContent = '—';
            sourceEl.className = 'monitor-source';
            domValEl.className = 'monitor-value';
        } else if (inputEventFired && eventValue === domVal) {
            sourceEl.textContent = 'REAL INPUT';
            sourceEl.className = 'monitor-source source-real';
            domValEl.className = 'monitor-value match';
        } else if (domVal && !inputEventFired) {
            sourceEl.textContent = 'JS INJECTED';
            sourceEl.className = 'monitor-source source-js';
            domValEl.className = 'monitor-value js-injected';
        } else if (eventValue !== domVal) {
            sourceEl.textContent = 'MODIFIED';
            sourceEl.className = 'monitor-source source-js';
            domValEl.className = 'monitor-value js-injected';
        } else {
            sourceEl.textContent = 'REAL INPUT';
            sourceEl.className = 'monitor-source source-real';
            domValEl.className = 'monitor-value match';
        }
    }

    document.addEventListener('focusin', function(e) {
        var tag = e.target.tagName;
        var isEditable = e.target.isContentEditable;
        if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT' || isEditable) {
            var newGroup = detectGroup(e.target);
            var stayingInGroup = isSameGroup(newGroup, activeGroup);
            activeField = e.target;
            eventValue = e.target.value || e.target.textContent || '';
            if (stayingInGroup) {
                inputEventFired = true;
            } else {
                keyLog = [];
                inputEventFired = false;
                activeGroup = newGroup;
                activeGroupLabel = newGroup ? getGroupLabel(newGroup) : '';
            }
            updateBar();
        }
    }, true);

    document.addEventListener('keydown', function(e) {
        if (!activeField) return;
        var isGroupKey = activeGroup && activeGroup.indexOf(e.target) !== -1;
        if (e.target !== activeField && !isGroupKey && !activeField.contains(e.target)) return;
        var key = e.key;
        if (key === 'Backspace') keyLog.push('\u232b');
        else if (key === 'Enter') keyLog.push('\u21b5');
        else if (key === 'Tab') keyLog.push('\u21e5');
        else if (key === 'Shift' || key === 'Control' || key === 'Alt' || key === 'Meta') { /* skip modifiers */ }
        else if (key.length === 1) keyLog.push(key);
        updateBar();
    }, true);

    document.addEventListener('input', function(e) {
        if (!activeField) return;
        var isGroupInput = activeGroup && activeGroup.indexOf(e.target) !== -1;
        if (e.target !== activeField && !isGroupInput && !activeField.contains(e.target)) return;
        inputEventFired = true;
        eventValue = e.target.value || e.target.textContent || '';
        activeField = e.target;
        updateBar();
    }, true);

    document.addEventListener('change', function(e) {
        if (e.target.tagName === 'SELECT') {
            activeField = e.target;
            activeGroup = null;
            activeGroupLabel = '';
            inputEventFired = true;
            eventValue = e.target.value;
            updateBar();
        }
    }, true);

    setInterval(function() {
        if (activeField) updateBar();
    }, 500);
})();
</script>
<script>
document.getElementById('themeToggle').addEventListener('click', function() {
    var html = document.documentElement;
    var current = html.getAttribute('data-theme') || 'dark';
    var next = current === 'dark' ? 'light' : 'dark';
    html.setAttribute('data-theme', next);
    localStorage.setItem('lt-theme', next);
});
</script>
</body>
</html>
